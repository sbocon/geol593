P1
================
Sam Ocon

Here, I’m loading in all the libraries I will be using for loading in
the data and cleaning it up. Specifically:

-   ape + phytools are used for general wrangling of phylogenetic trees,
    they’re also required by Claddis and paleotree

<!-- -->

    library(ape)
    library(paleotree)
    library(Claddis)

    ## Loading required package: phytools

    ## Loading required package: maps

    ## Loading required package: strap

    ## Loading required package: geoscale

    library(phytools)

------------------------------------------------------------------------

## Bringing in James’ tree and formatting it

Okay, now I’ve got to read in the tree James made in Mr Bayes.

    #Now I'm reading in the tree
    sc.tree <- read.nexus("Data/xiphnovbayes.con.tre")

    #What does it look like?
    plot(sc.tree, cex= 0.5, use.edge.length=FALSE, no.margin=TRUE)

![](R_markdown_file_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

That’s way too many taxa that aren’t relevant to me, let’s narrow it
down.

    #Add the tip and node labels and plot it again just to figure out what group I need to subset out

    plot(sc.tree, cex= 0.5, use.edge.length=FALSE, no.margin=TRUE)
    tiplabels(cex=0.5)
    nodelabels(cex=0.5)

![](R_markdown_file_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

    #Okay, now extract them to a new tree
    xipho <- extract.clade(sc.tree, 254)

Now that I’ve extracted the clade, I’m going to see if there are any
more tips/outgroups that I need to remove.

    #Plot tree with the labels
    plot(xipho, cex= 0.5, use.edge.length=FALSE, no.margin=TRUE)
    tiplabels(cex=0.5)
    nodelabels(cex=0.5)

![](R_markdown_file_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

    #Get rid of the outgroups I am not using
    xipho <- drop.tip(xipho, c(6:10))

Okay, now I have my tree, let’s take a look!

    plot(xipho, cex= 0.5, use.edge.length=FALSE, no.margin=TRUE)

![](R_markdown_file_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

Excellent, but as of Lamsdell, 2020, some of these names have been
changed, so we’re going to fix them by using indexing to rename the
incorrect tips (stored under the Xipho phylogenetic tree)

    # Take a look at the labels, noting which ones need to be changed and...
    xipho$tip.label

    ##  [1] "Euproops_anthrax"             "Euproops_mariae"             
    ##  [3] "Euproops_danae"               "Euproops_rotundatus"         
    ##  [5] "Euproops_sp"                  "Bellinurus_trilobitoides"    
    ##  [7] "Anacontium_carpenteri"        "Liomesaspis_laevis"          
    ##  [9] "Alanops_magnifica"            "Pringlia_birtwelli"          
    ## [11] "Kasibelinurus_amoricum"       "Kasibelinurus_randalli"      
    ## [13] "Lunataspis_aurora"            "Limulus_polyphemus"          
    ## [15] "Limulus_darwini"              "Limulus_coffini"             
    ## [17] "Crenatolimulus_paluxyensis"   "Carcinoscorpius_rotundicauda"
    ## [19] "Heterolimulus_gadeai"         "Tachypleus_gigas"            
    ## [21] "Tachypleus_decheni"           "Tachypleus_syriacus"         
    ## [23] "Tachypleus_tridentatus"       "Yunnanolimulus_luopingensis" 
    ## [25] "Xaniopyramis_linseyi"         "Paleolimulus_woodae"         
    ## [27] "Paleolimulus_signatus"        "Paleolimulus_kunguricus"     
    ## [29] "Bellinuroopsis_rossicus"      "Rolfeia_fouldenensis"        
    ## [31] "Tarracolimulus_rieki"         "Casterolimulus_kletti"       
    ## [33] "Limulitella_vicensis"         "Victalimulus_mcqueeni"       
    ## [35] "Limulus_woodwardi"            "Mesolimulus_crespelli"       
    ## [37] "Mesolimulus_sp"               "Mesolimulus_walchi"          
    ## [39] "Panduralimulus_babcocki"      "Tasmanian_limulid"           
    ## [41] "Austrolimulus_fletcheri"      "Vaderlimulus_tricki"         
    ## [43] "Psammolimulus_gottingensis"   "Limulitella_bronni"          
    ## [45] "Limulitella_tejraensis"       "Limulitella_henkeli"         
    ## [47] "Madagascan_limulid"           "Paleolimulus_fuchsbergensis" 
    ## [49] "Dubbolimulus_peetae"          "Paleolimulus_longispinus"    
    ## [51] "Valloisella_lievinensis"

    #Reassigning all of them!!
    xipho$tip.label[1] <- "Prestwichianella_anthrax"

    xipho$tip.label[2] <- "Prestwichianella_mariae"

    xipho$tip.label[4] <- "Prestwichianella_rotundatus"

    xipho$tip.label[5] <- "Andersoniella_sp"

    xipho$tip.label[6] <- "Belinurus_trilobitoides"

    xipho$tip.label[15] <- "Crenatolimulus_darwini"

    xipho$tip.label[26] <- "Norilimulus_woodae"

    xipho$tip.label[33] <- "Keuperlimulus_vicensis"

    xipho$tip.label[35] <- "Allolimulus_woodwardi"

    xipho$tip.label[37] <- "Mesolimulus_tafraoutensis"

    xipho$tip.label[40] <- "Tasmaniolimulus_patersoni"

    xipho$tip.label[46] <- "Yunnanolimulus_henkeli"

    xipho$tip.label[47] <- "Volanalimulus_madagascarensis"

    xipho$tip.label[48] <- "Batracholimulus_fuchsbergensis"

    xipho$tip.label[50] <- "Boeotiaspis_longispinus"

Now I have to add in new branches and taxa to the tree! I will do this
using the bind tip function from phytools! You can’t really add an edge
length-less branch without messing up the tree, so I just pulled the
edge lengths from their closest relative, as this was going to get fixed
by time scaling later!

    #Let's figure out what "temporary" branch lengths we should use
    #count the number of species we currently have
    nspecies<-length(xipho$tip.label)

    #Now, I'm telling R to basically make a numeric vector where it "names" each edge length from the tree with the taxa it corresponds to
    edgelengthnames<-setNames(xipho$edge.length[sapply(1:nspecies,function(x,y)   which(y==x),y=xipho$edge[,2])],xipho$tip.label)

    #Let's take a look at this!
    edgelengthnames

    ##       Prestwichianella_anthrax        Prestwichianella_mariae 
    ##                    0.003583472                    0.004960070 
    ##                 Euproops_danae    Prestwichianella_rotundatus 
    ##                    0.003960020                    0.004270800 
    ##               Andersoniella_sp        Belinurus_trilobitoides 
    ##                    0.003930276                    0.015822160 
    ##          Anacontium_carpenteri             Liomesaspis_laevis 
    ##                    0.007753796                    0.005138044 
    ##              Alanops_magnifica             Pringlia_birtwelli 
    ##                    0.003640961                    0.005106347 
    ##         Kasibelinurus_amoricum         Kasibelinurus_randalli 
    ##                    0.010631420                    0.010845530 
    ##              Lunataspis_aurora             Limulus_polyphemus 
    ##                    0.012630900                    0.003052069 
    ##         Crenatolimulus_darwini                Limulus_coffini 
    ##                    0.004821021                    0.006298731 
    ##     Crenatolimulus_paluxyensis   Carcinoscorpius_rotundicauda 
    ##                    0.004775780                    0.002644116 
    ##           Heterolimulus_gadeai               Tachypleus_gigas 
    ##                    0.017949060                    0.002607864 
    ##             Tachypleus_decheni            Tachypleus_syriacus 
    ##                    0.010661330                    0.010112010 
    ##         Tachypleus_tridentatus    Yunnanolimulus_luopingensis 
    ##                    0.002575190                    0.003061025 
    ##           Xaniopyramis_linseyi             Norilimulus_woodae 
    ##                    0.006218730                    0.011563900 
    ##          Paleolimulus_signatus        Paleolimulus_kunguricus 
    ##                    0.003077217                    0.004296224 
    ##        Bellinuroopsis_rossicus           Rolfeia_fouldenensis 
    ##                    0.004773853                    0.010535920 
    ##           Tarracolimulus_rieki          Casterolimulus_kletti 
    ##                    0.011955470                    0.007100205 
    ##         Keuperlimulus_vicensis          Victalimulus_mcqueeni 
    ##                    0.013067010                    0.004186220 
    ##          Allolimulus_woodwardi          Mesolimulus_crespelli 
    ##                    0.007841111                    0.005620181 
    ##      Mesolimulus_tafraoutensis             Mesolimulus_walchi 
    ##                    0.004830685                    0.003205033 
    ##        Panduralimulus_babcocki      Tasmaniolimulus_patersoni 
    ##                    0.004974700                    0.013121530 
    ##        Austrolimulus_fletcheri            Vaderlimulus_tricki 
    ##                    0.005777983                    0.004516579 
    ##     Psammolimulus_gottingensis             Limulitella_bronni 
    ##                    0.004584500                    0.010879310 
    ##         Limulitella_tejraensis         Yunnanolimulus_henkeli 
    ##                    0.005234001                    0.004982912 
    ##  Volanalimulus_madagascarensis Batracholimulus_fuchsbergensis 
    ##                    0.005331925                    0.011273880 
    ##            Dubbolimulus_peetae        Boeotiaspis_longispinus 
    ##                    0.004802345                    0.004741384 
    ##        Valloisella_lievinensis 
    ##                    0.012138190

Now that I have my edge lengths, I can now add in the new branches!

    #Rewriting my tree with new branches for each of the taxa that need to be added in
    xipho <- bind.tip(xipho, "Pickettia_carteri", edge.length=0.010631420, where=11, position=0)
    xipho <- bind.tip(xipho, "Stilpnocephalus_pontebbanus", edge.length=0.003640961, where=5, position=0)
    xipho <- bind.tip(xipho, "Moravurus_rehori", edge.length=0.006218730, where=45, position=0)
    xipho <- bind.tip(xipho, "Paleolimulus_jakovlevi", edge.length=0.004741384, where=94, position=0)

Okay, now does my tree look correct?

    plot(xipho, use.edge.length=FALSE)

![](R_markdown_file_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->

YAY! Now I can save it so I don’t have to run through this again!

    # Saving tree as a nexus file
    write.nexus(xipho, file = "Data/xipho_tree_updated.tre", translate = TRUE)
